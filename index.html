<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>AI RESCUE: CYBER MISSION ü§ñ</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root { --main: #00f2ff; --accent: #bc13fe; --danger: #ff0055; --success: #2ecc71; }
        body { font-family: 'Segoe UI', sans-serif; background: #050a10; color: #fff; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; }
        
        /* Giao di·ªán Neon Card */
        #game-box { background: rgba(16, 22, 32, 0.95); border: 2px solid var(--main); width: 90%; max-width: 600px; padding: 30px; border-radius: 15px; box-shadow: 0 0 20px var(--main), inset 0 0 10px var(--main); text-align: center; position: relative; }
        
        /* Thanh m√°u HP */
        .hp-container { width: 100%; height: 20px; background: #222; border-radius: 10px; margin: 10px 0; border: 1px solid #444; position: relative; }
        #hp-bar { width: 100%; height: 100%; background: linear-gradient(90deg, #ff0055, #2ecc71); border-radius: 10px; transition: 0.5s; }
        .hp-text { position: absolute; width: 100%; text-align: center; font-size: 12px; font-weight: bold; top: 2px; text-shadow: 1px 1px #000; }

        input { padding: 12px; border-radius: 5px; border: 1px solid var(--main); background: #000; color: var(--main); width: 80%; margin-bottom: 15px; text-align: center; box-shadow: 0 0 5px var(--main); }
        
        .ai-avatar { font-size: 50px; margin-bottom: 10px; filter: drop-shadow(0 0 10px var(--main)); }
        
        .grid { display: grid; grid-template-columns: 1fr; gap: 10px; margin-top: 20px; }
        .btn { background: rgba(0, 242, 255, 0.05); border: 1px solid var(--main); color: var(--main); padding: 12px; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.2s; text-transform: uppercase; letter-spacing: 1px; }
        .btn:hover:not(:disabled) { background: var(--main); color: #000; box-shadow: 0 0 15px var(--main); }
        
        #next-btn { display: none; margin-top: 20px; background: var(--accent); color: white; border: none; padding: 12px 40px; border-radius: 5px; cursor: pointer; font-weight: bold; box-shadow: 0 0 15px var(--accent); }

        /* Hi·ªáu ·ª©ng rung m√†n h√¨nh khi sai */
        .screen-shake { animation: shake 0.2s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }

        #final-screen, #play-screen { display: none; }
        .rank { font-size: 24px; font-weight: bold; color: var(--accent); margin-top: 10px; }
    </style>
</head>
<body>

<div id="game-box" id="main-container">
    <div id="login-screen">
        <div class="ai-avatar">ü§ñ</div>
        <h1 style="color: var(--main); text-shadow: 0 0 10px var(--main);">AI RESCUE MISSION</h1>
        <p style="color: #aaa;">H·ªá th·ªëng Bi-A ƒëang b·ªã t·∫•n c√¥ng b·ªüi d·ªØ li·ªáu r√°c!<br>H√£y nh·∫≠p th√¥ng tin ƒë·ªÉ gi·∫£i c·ª©u.</p>
        <input type="text" id="p-name" placeholder="T√äN CHI·∫æN BINH"><br>
        <input type="text" id="p-class" placeholder="M√É ƒê∆†N V·ªä (L·ªöP)"><br>
        <button class="btn" style="width: 85%;" onclick="checkLogin()">K√çCH HO·∫†T H·ªÜ TH·ªêNG</button>
    </div>

    <div id="play-screen">
        <div class="hp-container">
            <div id="hp-bar"></div>
            <div class="hp-text">H·ªÜ TH·ªêNG C√íN: <span id="hp-val">100</span>%</div>
        </div>
        <div class="ai-avatar" id="ai-icon">ü§ñ</div>
        <div id="q-text" style="font-size: 18px; margin: 15px 0; font-weight: bold; min-height: 40px;"></div>
        <div class="grid" id="ans-grid"></div>
        <button id="next-btn" onclick="nextStep()">TI·∫æP T·ª§C ‚ûî</button>
    </div>

    <div id="final-screen">
        <div id="final-icon" style="font-size: 60px;">üèÜ</div>
        <h1 id="final-title">K·∫æT QU·∫¢</h1>
        <p id="final-desc"></p>
        <div class="rank" id="rank-text"></div>
        <h2 id="final-score" style="color: var(--main); font-size: 40px;"></h2>
        <p id="save-status" style="color: #45a247;">ƒêang ƒë·ªìng b·ªô d·ªØ li·ªáu...</p>
        <button class="btn" onclick="location.reload()">L√ÄM L·∫†I NHI·ªÜM V·ª§</button>
    </div>
</div>

<iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"></iframe>

<script>
    const CONFIG_FORM = {
        formAction: "https://docs.google.com/forms/d/e/1FAIpQLSda4kGylYwxOjVrfn9VRXVgHqtjg2QhH3KvXYrZKSCrjB3zjQ/formResponse",
        entryName: "entry.2038111055",
        entryClass: "entry.1611801759",
        entryScore: "entry.1076541849"
    };

    const db = [
        {q: "ƒê·ªÉ tr√°nh AI nh·∫≠n di·ªán 'M·∫∑t c∆∞·ªùi' th√†nh 'M·∫∑t m·∫øu', ta c·∫ßn l·ªçc ·∫£nh th·∫≠t k·ªπ. ƒê√¢y l√† ti√™u chu·∫©n n√†o?", a: ["ƒê√∫ng (Accuracy)", "ƒê·ªß", "ƒêa d·∫°ng", "ƒê·∫Øt"], c: 0},
        {q: "AI ch·ªâ ƒë∆∞·ª£c h·ªçc ·∫£nh c·ªßa 1 b·∫°n trong nh√≥m n√™n kh√¥ng nh·∫≠n di·ªán ƒë∆∞·ª£c c√°c b·∫°n kh√°c. ƒê√¢y l√† l·ªói?", a: ["L·ªói ph·∫ßn c·ª©ng", "L·ªách (Bias)", "H·∫øt b·ªô nh·ªõ", "Virus"], c: 1},
        {q: "C√¢u n√≥i 'Garbage In - Garbage Out' nh·∫Øc nh·ªü ƒëi·ªÅu g√¨?", a: ["AI t·ª± d·ªçn r√°c", "D·ªØ li·ªáu r√°c cho k·∫øt qu·∫£ r√°c", "M√°y t√≠nh b·ªã h·ªèng", "C·∫ßn qu√©t d·ªçn ph√≤ng m√°y"], c: 1},
        {q: "C·∫ßn ch·ª•p ·∫£nh m·∫∑t ·ªü nhi·ªÅu g√≥c (tr√°i, ph·∫£i, th·∫≥ng) ƒë·ªÉ ƒë·∫£m b·∫£o ch·ªØ ƒê n√†o?", a: ["ƒê√∫ng", "ƒê·ªß", "ƒêa d·∫°ng (Diversity)", "ƒê·∫πp"], c: 2},
        {q: "M·ªói nh√£n c·∫£m x√∫c c·∫ßn t·ªëi thi·ªÉu bao nhi√™u m·∫´u ·∫£nh?", a: ["1 t·∫•m", "5 t·∫•m", "15-20 t·∫•m", "1000 t·∫•m"], c: 2},
        {q: "Khi AI ƒëo√°n sai, ta c·∫ßn quay l·∫°i ki·ªÉm tra ·∫£nh hu·∫•n luy·ªán. B∆∞·ªõc n√†y g·ªçi l√† g√¨?", a: ["X√≥a m√°y", "Truy v·∫øt ngu·ªìn l·ªói", "Ch·ª•p ·∫£nh l·∫°i", "N√¢ng c·∫•p RAM"], c: 1},
        {q: "ƒê·ªÉ m√°y kh√¥ng b·ªã 'L·ªách' (Bias), s·ªë l∆∞·ª£ng ·∫£nh gi·ªØa c√°c nh√£n n√™n nh∆∞ th·∫ø n√†o?", a: ["C√†ng √≠t c√†ng t·ªët", "Nh√£n nhi·ªÅu nh√£n √≠t", "B·∫±ng nhau", "Kh√¥ng quan tr·ªçng"], c: 2},
        {q: "Th·ª≠ th√°ch Bias (m·ªùi ng∆∞·ªùi l·∫° qu√©t th·ª≠) gi√∫p ki·ªÉm tra t√≠nh g√¨?", a: ["ƒê·ªô b·ªÅn m√°y", "T√≠nh ƒëa d·∫°ng", "T·ªëc ƒë·ªô m·∫°ng", "ƒê·ªô s√°ng ƒë√®n"], c: 1},
        {q: "·∫¢nh c√≥ b√†n tay che m·∫∑t ho·∫∑c v·∫≠t l·∫° che khu·∫•t l√† vi ph·∫°m ch·ªØ ƒê n√†o?", a: ["ƒê√∫ng (Accuracy)", "ƒê·ªß", "ƒê·∫πp", "L·∫°"], c: 0},
        {q: "N·∫øu d·ªØ li·ªáu ƒë√£ chu·∫©n m√† m√°y v·∫´n sai, ta c·∫ßn ch·ªânh y·∫øu t·ªë n√†o ·ªü b∆∞·ªõc Train?", a: ["Epochs & Batch size", "Thay Webcam m·ªõi", "X√≥a Form", "T·∫Øt tr√¨nh duy·ªát"], c: 0}
    ];

    let cur = 0, score = 0, hp = 100, canChoose = true;
    let pName = "", pClass = "";

    function checkLogin() {
        pName = document.getElementById('p-name').value;
        pClass = document.getElementById('p-class').value;
        if(pName && pClass) {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('play-screen').style.display = 'block';
            loadQ();
        } else { alert("H√£y nh·∫≠p T√™n v√† L·ªõp ƒë·ªÉ k√≠ch ho·∫°t Robot!"); }
    }

    function loadQ() {
        canChoose = true;
        document.getElementById('next-btn').style.display = 'none';
        document.getElementById('game-box').classList.remove('screen-shake');
        let q = db[cur];
        document.getElementById('q-text').innerText = "QUERY [" + (cur+1) + "]: " + q.q;
        
        let grid = document.getElementById('ans-grid');
        grid.innerHTML = '';
        q.a.forEach((txt, i) => {
            let b = document.createElement('button'); b.className = 'btn'; b.innerText = txt;
            b.onclick = () => {
                if(!canChoose) return;
                canChoose = false;
                if(i === q.c) {
                    b.style.background = "var(--success)"; b.style.color = "#000";
                    score += 20; confetti({particleCount: 40, spread: 50});
                } else {
                    b.style.background = "var(--danger)"; b.style.color = "#fff";
                    hp -= 15; score -= 5;
                    document.getElementById('game-box').classList.add('screen-shake');
                    if(hp < 0) hp = 0;
                    document.getElementById('hp-bar').style.width = hp + "%";
                    document.getElementById('hp-val').innerText = hp;
                }
                document.getElementById('next-btn').style.display = 'block';
                Array.from(grid.children).forEach(btn => btn.disabled = true);
            };
            grid.appendChild(b);
        });
    }

    function nextStep() {
        cur++;
        if(cur < db.length && hp > 0) loadQ();
        else finishGame();
    }

    function finishGame() {
        document.getElementById('play-screen').style.display = 'none';
        document.getElementById('final-screen').style.display = 'block';
        document.getElementById('final-score').innerText = score + " PTS";
        
        let rank = "";
        if(score >= 180) { rank = "RANK: CHI·∫æN BINH HUY·ªÄN THO·∫†I üíé"; document.getElementById('final-icon').innerText = "üëë"; }
        else if(score >= 120) { rank = "RANK: CHUY√äN GIA D·ªÆ LI·ªÜU üöÄ"; document.getElementById('final-icon').innerText = "‚≠ê"; }
        else { rank = "RANK: T·∫¨P S·ª∞ AI üõ†Ô∏è"; document.getElementById('final-icon').innerText = "ü§ñ"; }
        
        document.getElementById('rank-text').innerText = rank;
        document.getElementById('final-desc').innerText = "C·∫£m ∆°n " + pName + " ƒë√£ tham gia gi·∫£i c·ª©u!";

        // G·ª≠i d·ªØ li·ªáu ng·∫ßm
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = CONFIG_FORM.formAction;
        form.target = 'hidden_iframe';
        const data = {[CONFIG_FORM.entryName]: pName, [CONFIG_FORM.entryClass]: pClass, [CONFIG_FORM.entryScore]: score};
        for (const key in data) {
            const input = document.createElement('input'); input.type = 'hidden'; input.name = key; input.value = data[key];
            form.appendChild(input);
        }
        document.body.appendChild(form);
        form.submit();
    }
</script>
</body>
</html>
